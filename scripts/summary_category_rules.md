# ููุฎุต ููุงุนุฏ ุงูุชุตููู - Category Rules

## โ ูุง ุชู ุฅูุฌุงุฒู

### 1. ุงุณุชูุฑุงุฏ ููุงุนุฏ ุงูุชุตููู ูู D365
- **ุงูููู**: `category2026.xlsx`
- **ุงูุณุฌูุงุช**: 46 ูุงุนุฏุฉ ุชุตููู
- **ุงูุฌุฏูู**: `product_category_rules`
- **ุงูุญุงูุฉ**: โ **ููุชูู**

### 2. ุงูุจููุฉ

#### ุฌุฏูู `product_category_rules`:
- `prefix_pattern`: ุงูุจุงุฏุฆุฉ (ูุซู "10001", "10002", "1501")
- `category_name`: ุงุณู ุงูุชุตููู (ุจุงูุนุฑุจูุฉุ ูุซู "ูุญุงูุงุช ูููุบ", "ูุฎุฏุงุช ูููุบ")

#### ุฃูุซูุฉ ุนูู ุงูููุงุนุฏ:
- `10001` โ `ูุญุงูุงุช ูููุบ`
- `10002` โ `ูุญุงูุงุช ูููู`
- `10003` โ `ูุญุงูุงุช ูู`
- `15001` โ `ูุฎุฏุงุช ูููุบ`
- `1501` โ `ูุฎุฏุงุช ุณุชุงูุฏุฑุฏ`
- `1600` โ `ููุณ ูุฎุฏุฉ - ูููุบ`

### 3. ุงููุธุงู ุงููุฏูู vs ุงููุธุงู ุงูุฌุฏูุฏ

#### ุงููุธุงู ุงููุฏูู (2024-2025):
- **ุงููุนุชูุฏ**: `item_alias` (ูู gofrugal)
- **ุงูููุงุนุฏ**: Hardcoded ูู `calculator.ts`
  - `item_alias` ูุจุฏุฃ ุจู "4" โ "Duvets"
  - `item_alias` ูุจุฏุฃ ุจู "2" โ "Duvets Full"
  - ุงุณู ุงูููุชุฌ ูุญุชูู "mattresspad" โ "Toppers"
  - ุงุณู ุงูููุชุฌ ูุญุชูู "pillow" โ "Pillows"

#### ุงููุธุงู ุงูุฌุฏูุฏ (2026+):
- **ุงููุนุชูุฏ**: `item_code` (ูู D365)
- **ุงูููุงุนุฏ**: ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (`product_category_rules`)
- **ุงูุขููุฉ**: ูุทุงุจูุฉ `item_code` ูุน `prefix_pattern` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- **ุงูุฃููููุฉ**: ุฃุทูู prefix ุฃููุงู (ูุซู "10001" ูุจู "1000")

### 4. ุงููููุงุช ุงููุญุฏุซุฉ

#### `api/get-category-rules.ts` (ุฌุฏูุฏ)
- API endpoint ูุฌูุจ ููุงุนุฏ ุงูุชุตููู ูู PostgreSQL
- Returns: `{ success: true, rules: CategoryRule[], count: number }`

#### `src/utils/categoryHelper.ts` (ุฌุฏูุฏ)
- `getCategoryFromD365(itemCode)`: ุชุตููู ูู D365 item_code
- `getCategoryFromLegacy(product)`: ุชุตููู ูู legacy item_alias
- `getCategoryUnified(product, year)`: ุฏุงูุฉ ููุญุฏุฉ ุชุฏุนู ููุง ุงููุธุงููู

#### `src/utils/calculator.ts` (ูุญุฏุซ)
- `getCategory()` ูุญุฏุซ ูุน ุชุนูููุงุช ุชูุถุญ ุงููุธุงููู
- ูุญุงูุธ ุนูู ุงูุชูุงูู ูุน ุงูููุฏ ุงููุฏูู

### 5. ุงูุงุณุชุฎุฏุงู

#### ููุจูุงูุงุช ุงููุฏููุฉ (2024-2025):
```typescript
import { getCategory } from '../utils/calculator';
const category = getCategory({ name: 'Pillow Standard', alias: '4xxxx' });
// Returns: "Duvets"
```

#### ููุจูุงูุงุช ุงูุฌุฏูุฏุฉ (2026+):
```typescript
import { getCategoryUnified } from '../utils/categoryHelper';
const category = await getCategoryUnified(
  { item_code: '10001', name: 'Comforter King' }, 
  2026
);
// Returns: "ูุญุงูุงุช ูููุบ" (ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช)
```

### 6. API Endpoint

**GET** `/api/get-category-rules`

**Response**:
```json
{
  "success": true,
  "rules": [
    { "prefix_pattern": "10001", "category_name": "ูุญุงูุงุช ูููุบ" },
    { "prefix_pattern": "10002", "category_name": "ูุญุงูุงุช ูููู" },
    ...
  ],
  "count": 46
}
```

## ๐ ุงูุฅุญุตุงุฆูุงุช

- **ุฅุฌูุงูู ุงูููุงุนุฏ**: 46
- **ุงูุชุตูููุงุช ุงููุฑูุฏุฉ**: 46
- **ุฃุทูู prefix**: 5 ุฃุญุฑู (ูุซู "10001")
- **ุฃูุตุฑ prefix**: 4 ุฃุญุฑู (ูุซู "1501", "1600")

## โ ุงูุฎูุงุตุฉ

- โ ููุงุนุฏ ุงูุชุตููู ูุณุชูุฑุฏุฉ ูู `category2026.xlsx`
- โ API endpoint ุฌุงูุฒ ูุฌูุจ ุงูููุงุนุฏ
- โ Helper functions ุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู
- โ ุงููุธุงู ูุฏุนู ููุง ุงููุธุงููู (ุงููุฏูู ูุงูุฌุฏูุฏ)

**ุงูุฎุทูุฉ ุงูุชุงููุฉ**: ุชุญุฏูุซ ุงูููุฏ ูู `ProductsPage` ู `useDataProcessing` ูุงุณุชุฎุฏุงู `getCategoryUnified` ุนูุฏ ุงูุญุงุฌุฉ.
